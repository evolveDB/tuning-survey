
#Postgres


### Knobs for Postgres 

OtterTune;  
Too many knobs to tune;
LlamaTune



| Knob name                                   |            Selected by            |                                                                                                                  Note                                                                                                                  | Global | Dynamic/Restart? |  Type   | Default Values | Minimum value |               Maximum Value                | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                   |  
|:--------------------------------------------|:---------------------------------:|:--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------:|:------:|:----------------:|:-------:|:--------------:|:-------------:|:------------------------------------------:|:--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| backend_flush_after                         |        Too many; LlamaTune        |                                                                      Unless you have time to tune memory flushing behavior and test for improvements/regressions                                                                       |        |      false       | integer |   0   没有刷写控制   |   0 禁用受控写回    |                  2MB 强制写回                  | 只要一个后端写入了超过backend_flush_after字节， 就会尝试强制 OS 把这些写发送到底层存储。 这样做将会限制内核页高速缓存中的脏数据数量， 降低在检查点末尾发出 fsync 时或者 OS 在后台大批写回数据时卡住的可能性。 这常常会导致极大降低的事务延迟，但是也有一些情况中 （特别是负载超过shared_buffers但低于 OS 的页面高速缓存时),性能可能会下降                                                                                                                                                                                                                                                            | 
| bgwriter_flush_after                        |             Too many              |                                                                                    be set in the postgresql.conf file or on the server command line                                                                                    |        |      false       | integer |   64 (512kB)   |       0       |                 256 (2MB)                  | unit大小 8kB  只要后台写入的数据超过这个数量，尝试强制 OS 把这些写发送到底层存储上。这样做将限制内核页缓存中脏数据的量，降低了在检查点末尾发出一个 fsync 时或者 OS 在后台大批量写回数据时卡住的可能性。 那常常会导致大幅度压缩的事务延迟，但是也有一些情况（特别是负载超过shared_buffers但小于 OS 页面高速缓存）的性能会降低。                                                                                                                                                                                                                                                                         |                                                                                                                                                                                         |
| bgwriter_lru_maxpages                       |             OtterTune             |                                                                                    be set in the postgresql.conf file or on the server command line                                                                                    |        |      false       | integer |      100       |       0       |                 1073741823                 | 在每个轮次中，不超过这么多个缓冲区将被后台写入器写出。把这个参数设置为零可禁用后台写出（注意被一个独立、专用辅助进程管理的检查点不受影响）。默认值是 100 个缓冲区。                                                                                                                                                                                                                                                                                                                                                                          |
| ~~checkpoint_segments~~                     |           M; OtterTune            |                                                                                                             9.4 Deprecated                                                                                                             |        |                  |         |                |               |                                            |                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| commit_delay                                |        Too many; LlamaTune        | A primitive form of group commit without asynchronicity. Performance testing of this is very mixed; only set to non-zero if you have time to test the specific performance impact on your workload. Reasonable values are 200 to 1000. |        |      false       | integer |       0        |       0       |                   100000                   | 在一次 WAL 刷写被发起之前，commit_delay增加一个时间延迟，以微妙计。只有超级用户才能修改这个设置。                                                                                                                                                                                                                                                                                                                                                                                                     |
| deadlock_timeout                            |                                   |                                                  Default is fine, except when you are troubleshooting/monitoring locks. In that case, you may want to lower it to as little as 50ms.                                                   |        |      false       | integer |   1000 (1s)    |    1 (1ms)    |         2147483647 (2147483647ms)          | 这是进行死锁检测之前在一个锁上等待的总时间（以毫秒计）。                                                                                                                                                                                                                                                                                                                                                                                                                                  |                                                                                                                                                                                                                                                                                                   |
| default_statistics_target                   |                                   |  Most applications can use the default of 100. For very small/simple databases, decrease to 10 or 50. Data warehousing applications generally need to use 500 to 1000. Otherwise, increase statistics targets on a per-column basis.   |        |      false       | integer |      100       |       1       |                   10000                    | 为没有通过ALTER TABLE SET STATISTICS设置列相关目标的表列设置默认统计目标。更大的值增加了需要做ANALYZE的时间，但是可能会改善规划器的估计质量。                                                                                                                                                                                                                                                                                                                                                                       |
| default_stats_target ∗ effective_cache_size |                                   |                                                                                                                                                                                                                                        |        |                  |         |                |               |                                            |                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| effective_cache_size                        |      M; OtterTune; Too many       |                                                                                                                                                                                                                                        |        |      false       | integer |  524288 (4GB)  |    1 (8kB)    |         2147483647 (17179869176kB)         | 设置规划器对一个单一查询可用的有效磁盘缓冲区尺寸的假设。这个参数会被考虑在使用一个索引的代价估计中，更高的数值会使得索引扫描更可能被使用，更低的数值会使得顺序扫描更可能被使用。                                                                                                                                                                                                                                                                                                                                                                      |
| deadlock_timeout ∗ effective_cache_size     |             OtterTune             |                                                                                                                                                                                                                                        |        |                  |         |                |               |                                            |                                                                                                                                                                                                                                                                                                                                                                                                                                                               |                                                                                                                                                                                                                                                                                                   |
| effective_io_concurrency                    |             Too many              |                                                                                                                                                                                                                                        |        |      false       | integer |       1        |       0       |                    1000                    | Number of simultaneous requests that can be handled efficiently by the disk subsystem                                                                                                                                                                                                                                                                                                                                                                         |
| fsync                                       |             Too many;             |                                                                                                                                                                                                                                        |        |      false       |  bool   |       on       |       -       |                     -                      | determines whether or not the system will force all data to be written to disk before a transaction is considered to be committed.<br/>on: flushes all writes to disk before confirming the commit. <br/>off: can improve performance, but at the risk of losing data in the event of a system crash or power failure. This option should only be used if the entire database can be easily recreated.                                                        |
| gepo_pool_size                              |             LlamaTune             |                                                                                                    GEQO: Genetic Query Optimization                                                                                                    |        |      false       | integer |       0        |       0       |                 2147483647                 | Controls the pool size used by GEQO, that is the number of individuals in the genetic population. It must be at least two, and useful values are typically 100 to 1000. If it is set to zero (the default setting) then a suitable value is chosen based on geqo_effort and the number of tables in the query.                                                                                                                                                |
| maintenance_work_mem                        |                M;                 |                                             not to set the default value too high, which can cause excessive memory usage and lead to memory contention with other processes on the system                                             |        |      false       | integer |  65536(64MB)   |   1024(1MB)   |                2147483647kB                | Sets the maximum memory to be used for maintenance operations                                                                                                                                                                                                                                                                                                                                                                                                 |
| max_parallel_workers_per_gather             |             Too many              |                                                                                                               since v9.6                                                                                                               |        |      false       | integer |       2        |       0       |                    1024                    | The maximum number of parallel processes per executor node                                                                                                                                                                                                                                                                                                                                                                                                    |
| max_wal_size                                |             Too many              |                                                                  since v9.5 This parameter can only be set in the postgresql.conf file or on the server command line                                                                   |        |      false       | integer |   1024(1GB)    |    2(2MB)     |         2147483647 (2147483647MB)          | when the WAL reaches this size, PostgreSQL will trigger a checkpoint to flush the WAL to disk and recycle old WAL files. This helps ensure that the WAL does not grow too large and consume excessive disk space.                                                                                                                                                                                                                                             |
| shared_buffers                              | M; OtterTune; Too many; LlamaTune |                                                                                                                                                                                                                                        |        |       true       | integer |  16384(128MB)  |   16(128kB)   |         1073741823 (8589934584kB)          | Sets the amount of memory the database server uses for shared memory buffers.<br/>If you have a dedicated database server with 1GB or more of RAM, a reasonable starting value for shared_buffers is 25% of the memory in your system. <br/> Larger settings for shared_buffers usually require a corresponding increase in max_wal_size, in order to spread out the process of writing large quantities of new or changed data over a longer period of time. |
| temp_buffers                                |             Too many              |                                                                                                                                                                                                                                        |        |      false       | integer |   1024(8MB)    |  100(800kB)   |         1073741823 (8589934584kB)          | Sets the maximum number of temporary buffers used by each session                                                                                                                                                                                                                                                                                                                                                                                             |
| wal_buffers                                 |      M; Too many; LlamaTune       |                                                                                                                                                                                                                                        |        |       true       | integer |       -1       |      -1       |             262143 (2097144kB)             | Sets the number of disk-page buffers in shared memory for WAL                                                                                                                                                                                                                                                                                                                                                                                                 |
| wal_sync_method                             |             Too many              |                                                                                                                                                                                                                                        |        |      false       |  enum   |   fdatasync    |               | fsync, fdatasync, open_sync, open_datasync | Selects the method used for forcing WAL updates to disk                                                                                                                                                                                                                                                                                                                                                                                                       |                                                                                                                                                                                                                                                                                                   | 
| wal_writer_delay                            |             Too many              |                                                                                                                                                                                                                                        |        |      false       | integer |   200(200ms)   |    1(1ms)     |                 10000(10s)                 | Specifies how often the WAL writer flushes WAL                                                                                                                                                                                                                                                                                                                                                                                                                |
| wal_writer_flush_after                      |        Too many; LlamaTune        |                                                                                                               since v9.6                                                                                                               |        |      false       | integer |    128(1MB)    |    0(0kB)     |         2147483647 (17179869176kB)         | Specifies how often the WAL writer flushes WAL, in volume terms. Amount of WAL written out by WAL writer that triggers a flush                                                                                                                                                                                                                                                                                                                                |
| work_mem                                    |            M; Too many            |                                                                                                                                                                                                                                        |        |      false       | integer |   4096(4MB)    |   64(64kB)    |         2147483647 (2147483647kB)          | Sets the base maximum amount of memory to be used by a query operation (such as a sort or hash table) before writing to temporary disk files.                                                                                                                                                                                                                                                                                                                 |


some tuning recommendations from https://postgresqlco.nf
